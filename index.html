<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SBOM Explorer</title>
    <meta name="description" content="Beautiful, fast SBOM viewer for CycloneDX JSON with history and vulnerability context." />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind config: fine-tuned, but small
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
            colors: {
              ink: '#0f172a',
              stone: '#334155',
              brand: { 50:'#eef2ff', 400:'#818cf8', 500:'#6366f1', 600:'#4f46e5', 700:'#4338ca' },
              ok:'#10b981', warn:'#f59e0b', bad:'#ef4444'
            },
            boxShadow: {
              'soft': '0 10px 30px -12px rgba(2,6,23,.15)'
            }
          }
        }
      }
    </script>
    <style>
      html,body{height:100%}
      ::selection{background:#c7d2fe;color:#111827}
      .chip{ @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-700 border border-slate-200;}
      .kpi{ @apply rounded-2xl p-4 bg-white shadow-soft border border-slate-100;}
      .card{ @apply rounded-2xl bg-white shadow-soft border border-slate-100;}
      .btn{ @apply inline-flex items-center gap-2 rounded-xl px-3 py-2 text-sm font-semibold border border-slate-200 hover:bg-slate-50;}
      .tab{ @apply cursor-pointer px-3 py-2 rounded-xl text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-100;}
      .tab-active{ @apply bg-ink text-white hover:bg-ink hover:text-white;}
      .mono{ font-variant-ligatures:none; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
      .pill{ @apply text-xs px-2.5 py-1 rounded-full font-semibold;}
      .pill-ok{ @apply bg-green-50 text-green-700 border border-green-200;}
      .pill-warn{ @apply bg-amber-50 text-amber-700 border border-amber-200;}
      .pill-bad{ @apply bg-red-50 text-red-700 border border-red-200;}
      .tbl th{ @apply sticky top-0 z-10 bg-slate-50/90 backdrop-blur text-left text-xs font-semibold text-slate-600 uppercase tracking-wide border-b px-3 py-2;}
      .tbl td{ @apply align-top whitespace-pre-wrap px-3 py-2 border-b; }
      .tbl tr:hover td{ @apply bg-slate-50;}
      .srch{ @apply w-full rounded-xl border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand-400;}
      .fade-in{ animation:fade .3s ease-in-out;}
      @keyframes fade{ from{opacity:0; transform: translateY(4px)} to{opacity:1; transform: none} }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-100">
      <div class="mx-auto max-w-7xl px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="h-9 w-9 rounded-xl bg-brand-600 grid place-items-center text-white font-extrabold">S</div>
          <div>
            <h1 class="text-xl font-extrabold leading-tight">SBOM Explorer</h1>
            <p id="subtitle" class="text-xs text-slate-500">Loading index…</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <a class="btn" href="public/sbom-index.json" target="_blank" rel="noreferrer">sbom-index.json</a>
          <a class="btn" href="public/history.json" target="_blank" rel="noreferrer">history.json</a>
          <a class="btn" href="public/tracker.json" target="_blank" rel="noreferrer">tracker.json</a>
          <a class="btn" href="sboms/manifest.json" target="_blank" rel="noreferrer">manifest.json</a>
          <a id="downloadBtn" class="btn hidden" rel="noreferrer">Download view</a>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-4 py-6 grid gap-6">
      <!-- KPI STRIP -->
      <section id="kpis" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></section>

      <!-- Tabs -->
      <nav class="flex gap-2">
        <button data-tab="overview" class="tab tab-active">Overview</button>
        <button data-tab="components" class="tab">Components</button>
        <button data-tab="vulns" class="tab">Vulnerabilities</button>
        <button data-tab="history" class="tab">History</button>
        <button data-tab="files" class="tab">Files</button>
      </nav>

      <!-- Overview -->
      <section id="tab-overview" class="card p-5 fade-in">
        <div class="grid gap-6 lg:grid-cols-3">
          <div class="lg:col-span-2 grid gap-4">
            <div class="card p-4">
              <h2 class="text-lg font-bold mb-2">Current SBOMs</h2>
              <div id="sbomList" class="grid gap-3"></div>
            </div>
            <div class="card p-4">
              <h2 class="text-lg font-bold mb-2">Metadata</h2>
              <dl id="metaList" class="grid grid-cols-1 sm:grid-cols-2 gap-y-2 gap-x-6"></dl>
            </div>
          </div>
          <aside class="card p-4">
            <h3 class="text-lg font-bold mb-3">Quick filters</h3>
            <div class="grid gap-3">
              <input id="quickSearch" class="srch" type="search" placeholder="Search name, purl, license… (press ⏎)" />
              <div class="flex flex-wrap gap-2" id="licenseCloud"></div>
              <div class="flex flex-wrap gap-2" id="vendorCloud"></div>
            </div>
          </aside>
        </div>
      </section>

      <!-- Components -->
      <section id="tab-components" class="card p-0 hidden fade-in">
        <div class="p-4 flex items-center justify-between gap-3 flex-wrap">
          <div class="flex items-center gap-2">
            <input id="compSearch" class="srch" type="search" placeholder="Filter components…" />
            <span id="compCount" class="chip">0</span>
          </div>
          <div class="flex items-center gap-2 text-sm">
            <label class="flex items-center gap-2"><input id="toggleDev" type="checkbox"/> <span>Include dev/test</span></label>
            <label class="flex items-center gap-2"><input id="toggleNoLicense" type="checkbox"/> <span>Only with license</span></label>
          </div>
        </div>
        <div class="overflow-auto">
          <table class="tbl w-full">
            <thead>
              <tr>
                <th class="w-[20%]">Name</th>
                <th>Version</th>
                <th class="w-[18%]">PURL</th>
                <th class="w-[14%]">License</th>
                <th class="w-[14%]">Supplier</th>
                <th class="w-[10%]">Scope</th>
              </tr>
            </thead>
            <tbody id="componentsBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Vulnerabilities -->
      <section id="tab-vulns" class="card p-0 hidden fade-in">
        <div class="p-4 flex items-center justify-between gap-3 flex-wrap">
          <input id="vulnSearch" class="srch" type="search" placeholder="Filter vulnerabilities…" />
          <span id="vulnCount" class="chip">0</span>
        </div>
        <div class="overflow-auto">
          <table class="tbl w-full">
            <thead>
              <tr>
                <th class="w-[18%]">ID</th>
                <th class="w-[12%]">Severity</th>
                <th class="w-[16%]">Affects</th>
                <th class="w-[14%]">Version Range</th>
                <th class="w-[40%]">Description</th>
              </tr>
            </thead>
            <tbody id="vulnsBody"></tbody>
          </table>
        </div>
      </section>

      <!-- History -->
      <section id="tab-history" class="card p-4 hidden fade-in">
        <div id="history" class="grid gap-4"></div>
      </section>

      <!-- Files -->
      <section id="tab-files" class="card p-4 hidden fade-in">
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-bold mb-2">public/</h3>
            <div id="publicFiles" class="grid gap-2"></div>
          </div>
          <div>
            <h3 class="text-lg font-bold mb-2">sboms/</h3>
            <div id="sbomFiles" class="grid gap-2"></div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mx-auto max-w-7xl px-4 pb-10 text-center text-xs text-slate-500">
      Built for <a class="underline" href="https://github.com/Sidbhasin13/sbom-parser" target="_blank" rel="noreferrer">sbom-parser</a> — zero backend, just JSON.
    </footer>

    <script src="parse-sbom.js"></script>
  </body>
</html>
